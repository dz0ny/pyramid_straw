var enums_1 = require('../enums');
var PlanService = (function () {
    function PlanService() {
        this.NODE_TYPE_PROP = 'Node Type';
        this.ACTUAL_ROWS_PROP = 'Actual Rows';
        this.PLAN_ROWS_PROP = 'Plan Rows';
        this.ACTUAL_TOTAL_TIME_PROP = 'Actual Total Time';
        this.ACTUAL_LOOPS_PROP = 'Actual Loops';
        this.TOTAL_COST_PROP = 'Total Cost';
        this.PLANS_PROP = 'Plans';
        this.RELATION_NAME_PROP = 'Relation Name';
        this.SCHEMA_PROP = 'Schema';
        this.ALIAS_PROP = 'Alias';
        this.GROUP_KEY_PROP = 'Group Key';
        this.SORT_KEY_PROP = 'Sort Key';
        this.JOIN_TYPE_PROP = 'Join Type';
        this.INDEX_NAME_PROP = 'Index Name';
        this.HASH_CONDITION_PROP = 'Hash Cond';
        this.COMPUTED_TAGS_PROP = '*Tags';
        this.COSTLIEST_NODE_PROP = '*Costiest Node (by cost)';
        this.LARGEST_NODE_PROP = '*Largest Node (by rows)';
        this.SLOWEST_NODE_PROP = '*Slowest Node (by duration)';
        this.MAXIMUM_COSTS_PROP = '*Most Expensive Node (cost)';
        this.MAXIMUM_ROWS_PROP = '*Largest Node (rows)';
        this.MAXIMUM_DURATION_PROP = '*Slowest Node (time)';
        this.ACTUAL_DURATION_PROP = '*Actual Duration';
        this.ACTUAL_COST_PROP = '*Actual Cost';
        this.PLANNER_ESTIMATE_FACTOR = '*Planner Row Estimate Factor';
        this.PLANNER_ESIMATE_DIRECTION = '*Planner Row Estimate Direction';
        this.CTE_SCAN_PROP = 'CTE Scan';
        this.CTE_NAME_PROP = 'CTE Name';
        this.ARRAY_INDEX_KEY = 'arrayIndex';
        this.PEV_PLAN_TAG = 'plan_';
        this._maxRows = 0;
        this._maxCost = 0;
        this._maxDuration = 0;
    }
    PlanService.prototype.getPlans = function () {
        var plans = [];
        for (var i in localStorage) {
            if (_.startsWith(i, this.PEV_PLAN_TAG)) {
                plans.push(JSON.parse(localStorage[i]));
            }
        }
        return _.chain(plans)
            .sortBy('createdOn')
            .reverse()
            .value();
    };
    PlanService.prototype.getPlan = function (id) {
        return JSON.parse(localStorage.getItem(id));
    };
    PlanService.prototype.createPlan = function (planName, planContent, planQuery) {
        var plan = {
            id: this.PEV_PLAN_TAG + new Date().getTime().toString(),
            name: planName || 'plan created on ' + moment().format('LLL'),
            createdOn: new Date(),
            content: JSON.parse(planContent)[0],
            query: planQuery
        };
        this.analyzePlan(plan);
        return plan;
    };
    PlanService.prototype.isJsonString = function (str) {
        try {
            JSON.parse(str);
        }
        catch (e) {
            return false;
        }
        return true;
    };
    PlanService.prototype.analyzePlan = function (plan) {
        this.processNode(plan.content.Plan);
        plan.content[this.MAXIMUM_ROWS_PROP] = this._maxRows;
        plan.content[this.MAXIMUM_COSTS_PROP] = this._maxCost;
        plan.content[this.MAXIMUM_DURATION_PROP] = this._maxDuration;
        this.findOutlierNodes(plan.content.Plan);
        localStorage.setItem(plan.id, JSON.stringify(plan));
    };
    PlanService.prototype.deletePlan = function (plan) {
        localStorage.removeItem(plan.id);
    };
    PlanService.prototype.deleteAllPlans = function () {
        localStorage.clear();
    };
    PlanService.prototype.processNode = function (node) {
        var _this = this;
        this.calculatePlannerEstimate(node);
        this.calculateActuals(node);
        _.each(node, function (value, key) {
            _this.calculateMaximums(node, key, value);
            if (key === _this.PLANS_PROP) {
                _.each(value, function (value) {
                    _this.processNode(value);
                });
            }
        });
    };
    PlanService.prototype.calculateMaximums = function (node, key, value) {
        if (key === this.ACTUAL_ROWS_PROP && this._maxRows < value) {
            this._maxRows = value;
        }
        if (key === this.ACTUAL_COST_PROP && this._maxCost < value) {
            this._maxCost = value;
        }
        if (key === this.ACTUAL_DURATION_PROP && this._maxDuration < value) {
            this._maxDuration = value;
        }
    };
    PlanService.prototype.findOutlierNodes = function (node) {
        var _this = this;
        node[this.SLOWEST_NODE_PROP] = false;
        node[this.LARGEST_NODE_PROP] = false;
        node[this.COSTLIEST_NODE_PROP] = false;
        if (node[this.ACTUAL_COST_PROP] === this._maxCost) {
            node[this.COSTLIEST_NODE_PROP] = true;
        }
        if (node[this.ACTUAL_ROWS_PROP] === this._maxRows) {
            node[this.LARGEST_NODE_PROP] = true;
        }
        if (node[this.ACTUAL_DURATION_PROP] === this._maxDuration) {
            node[this.SLOWEST_NODE_PROP] = true;
        }
        _.each(node, function (value, key) {
            if (key === _this.PLANS_PROP) {
                _.each(value, function (value) {
                    _this.findOutlierNodes(value);
                });
            }
        });
    };
    PlanService.prototype.calculateActuals = function (node) {
        var _this = this;
        node[this.ACTUAL_DURATION_PROP] = node[this.ACTUAL_TOTAL_TIME_PROP];
        node[this.ACTUAL_COST_PROP] = node[this.TOTAL_COST_PROP];
        console.log(node);
        _.each(node.Plans, function (subPlan) {
            console.log('processing chldren', subPlan);
            if (subPlan[_this.NODE_TYPE_PROP] !== _this.CTE_SCAN_PROP) {
                node[_this.ACTUAL_DURATION_PROP] = node[_this.ACTUAL_DURATION_PROP] - subPlan[_this.ACTUAL_TOTAL_TIME_PROP];
                node[_this.ACTUAL_COST_PROP] = node[_this.ACTUAL_COST_PROP] - subPlan[_this.TOTAL_COST_PROP];
            }
        });
        if (node[this.ACTUAL_COST_PROP] < 0) {
            node[this.ACTUAL_COST_PROP] = 0;
        }
        node[this.ACTUAL_DURATION_PROP] = node[this.ACTUAL_DURATION_PROP] * node[this.ACTUAL_LOOPS_PROP];
    };
    PlanService.prototype.calculatePlannerEstimate = function (node) {
        node[this.PLANNER_ESTIMATE_FACTOR] = node[this.ACTUAL_ROWS_PROP] / node[this.PLAN_ROWS_PROP];
        node[this.PLANNER_ESIMATE_DIRECTION] = enums_1.EstimateDirection.under;
        if (node[this.PLANNER_ESTIMATE_FACTOR] < 1) {
            node[this.PLANNER_ESIMATE_DIRECTION] = enums_1.EstimateDirection.over;
            node[this.PLANNER_ESTIMATE_FACTOR] = node[this.PLAN_ROWS_PROP] / node[this.ACTUAL_ROWS_PROP];
        }
    };
    return PlanService;
})();
exports.PlanService = PlanService;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL3BsYW4tc2VydmljZS50cyJdLCJuYW1lcyI6WyJQbGFuU2VydmljZSIsIlBsYW5TZXJ2aWNlLmNvbnN0cnVjdG9yIiwiUGxhblNlcnZpY2UuZ2V0UGxhbnMiLCJQbGFuU2VydmljZS5nZXRQbGFuIiwiUGxhblNlcnZpY2UuY3JlYXRlUGxhbiIsIlBsYW5TZXJ2aWNlLmlzSnNvblN0cmluZyIsIlBsYW5TZXJ2aWNlLmFuYWx5emVQbGFuIiwiUGxhblNlcnZpY2UuZGVsZXRlUGxhbiIsIlBsYW5TZXJ2aWNlLmRlbGV0ZUFsbFBsYW5zIiwiUGxhblNlcnZpY2UucHJvY2Vzc05vZGUiLCJQbGFuU2VydmljZS5jYWxjdWxhdGVNYXhpbXVtcyIsIlBsYW5TZXJ2aWNlLmZpbmRPdXRsaWVyTm9kZXMiLCJQbGFuU2VydmljZS5jYWxjdWxhdGVBY3R1YWxzIiwiUGxhblNlcnZpY2UuY2FsY3VsYXRlUGxhbm5lckVzdGltYXRlIl0sIm1hcHBpbmdzIjoiQUFDQSxzQkFBZ0MsVUFBVSxDQUFDLENBQUE7QUFJM0M7SUFBQUE7UUFFSUMsbUJBQWNBLEdBQVdBLFdBQVdBLENBQUNBO1FBQ3JDQSxxQkFBZ0JBLEdBQVdBLGFBQWFBLENBQUNBO1FBQ3pDQSxtQkFBY0EsR0FBV0EsV0FBV0EsQ0FBQ0E7UUFDckNBLDJCQUFzQkEsR0FBV0EsbUJBQW1CQSxDQUFDQTtRQUNyREEsc0JBQWlCQSxHQUFXQSxjQUFjQSxDQUFDQTtRQUMzQ0Esb0JBQWVBLEdBQVdBLFlBQVlBLENBQUNBO1FBQ3ZDQSxlQUFVQSxHQUFXQSxPQUFPQSxDQUFDQTtRQUM3QkEsdUJBQWtCQSxHQUFXQSxlQUFlQSxDQUFDQTtRQUM3Q0EsZ0JBQVdBLEdBQVdBLFFBQVFBLENBQUNBO1FBQy9CQSxlQUFVQSxHQUFXQSxPQUFPQSxDQUFDQTtRQUM3QkEsbUJBQWNBLEdBQVdBLFdBQVdBLENBQUNBO1FBQ3JDQSxrQkFBYUEsR0FBV0EsVUFBVUEsQ0FBQ0E7UUFDbkNBLG1CQUFjQSxHQUFXQSxXQUFX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QSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQTtRQUM3RkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EseUJBQXlCQSxDQUFDQSxHQUFHQSx5QkFBaUJBLENBQUNBLEtBQUtBLENBQUNBO1FBRS9EQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSx1QkFBdUJBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3pDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSx5QkFBeUJBLENBQUNBLEdBQUdBLHlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFDOURBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLHVCQUF1QkEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQTtRQUNqR0EsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFDTGIsa0JBQUNBO0FBQURBLENBaE1BLEFBZ01DQSxJQUFBO0FBaE1ZLG1CQUFXLGNBZ012QixDQUFBIiwiZmlsZSI6InNlcnZpY2VzL3BsYW4tc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SVBsYW59IGZyb20gJy4uL2ludGVyZmFjZXMvaXBsYW4nO1xuaW1wb3J0IHtFc3RpbWF0ZURpcmVjdGlvbn0gZnJvbSAnLi4vZW51bXMnO1xuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIm1vbWVudC5kLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJsb2Rhc2guZC50c1wiIC8+XG5cbmV4cG9ydCBjbGFzcyBQbGFuU2VydmljZSB7XG4gICAgLy8gcGxhbiBwcm9wZXJ0eSBrZXlzXG4gICAgTk9ERV9UWVBFX1BST1A6IHN0cmluZyA9ICdOb2RlIFR5cGUnO1xuICAgIEFDVFVBTF9ST1dTX1BST1A6IHN0cmluZyA9ICdBY3R1YWwgUm93cyc7XG4gICAgUExBTl9ST1dTX1BST1A6IHN0cmluZyA9ICdQbGFuIFJvd3MnO1xuICAgIEFDVFVBTF9UT1RBTF9USU1FX1BST1A6IHN0cmluZyA9ICdBY3R1YWwgVG90YWwgVGltZSc7XG4gICAgQUNUVUFMX0xPT1BTX1BST1A6IHN0cmluZyA9ICdBY3R1YWwgTG9vcHMnO1xuICAgIFRPVEFMX0NPU1RfUFJPUDogc3RyaW5nID0gJ1RvdGFsIENvc3QnO1xuICAgIFBMQU5TX1BST1A6IHN0cmluZyA9ICdQbGFucyc7XG4gICAgUkVMQVRJT05fTkFNRV9QUk9QOiBzdHJpbmcgPSAnUmVsYXRpb24gTmFtZSc7XG4gICAgU0NIRU1BX1BST1A6IHN0cmluZyA9ICdTY2hlbWEnO1xuICAgIEFMSUFTX1BST1A6IHN0cmluZyA9ICdBbGlhcyc7XG4gICAgR1JPVVBfS0VZX1BST1A6IHN0cmluZyA9ICdHcm91cCBLZXknO1xuICAgIFNPUlRfS0VZX1BST1A6IHN0cmluZyA9ICdTb3J0IEtleSc7XG4gICAgSk9JTl9UWVBFX1BST1A6IHN0cmluZyA9ICdKb2luIFR5cGUnO1xuICAgIElOREVYX05BTUVfUFJPUDogc3RyaW5nID0gJ0luZGV4IE5hbWUnO1xuICAgIEhBU0hfQ09ORElUSU9OX1BST1A6IHN0cmluZyA9ICdIYXNoIENvbmQnO1xuXG4gICAgLy8gY29tcHV0ZWQgYnkgcGV2XG4gICAgQ09NUFVURURfVEFHU19QUk9QOiBzdHJpbmcgPSAnKlRhZ3MnO1xuXG4gICAgQ09TVExJRVNUX05PREVfUFJPUDogc3RyaW5nID0gJypDb3N0aWVzdCBOb2RlIChieSBjb3N0KSc7XG4gICAgTEFSR0VTVF9OT0RFX1BST1A6IHN0cmluZyA9ICcqTGFyZ2VzdCBOb2RlIChieSByb3dzKSc7XG4gICAgU0xPV0VTVF9OT0RFX1BST1A6IHN0cmluZyA9ICcqU2xvd2VzdCBOb2RlIChieSBkdXJhdGlvbiknO1xuXG4gICAgTUFYSU1VTV9DT1NUU19QUk9QOiBzdHJpbmcgPSAnKk1vc3QgRXhwZW5zaXZlIE5vZGUgKGNvc3QpJztcbiAgICBNQVhJTVVNX1JPV1NfUFJPUDogc3RyaW5nID0gJypMYXJnZXN0IE5vZGUgKHJvd3MpJztcbiAgICBNQVhJTVVNX0RVUkFUSU9OX1BST1A6IHN0cmluZyA9ICcqU2xvd2VzdCBOb2RlICh0aW1lKSc7XG4gICAgQUNUVUFMX0RVUkFUSU9OX1BST1A6IHN0cmluZyA9ICcqQWN0dWFsIER1cmF0aW9uJztcbiAgICBBQ1RVQUxfQ09TVF9QUk9QOiBzdHJpbmcgPSAnKkFjdHVhbCBDb3N0JztcbiAgICBQTEFOTkVSX0VTVElNQVRFX0ZBQ1RPUjogc3RyaW5nID0gJypQbGFubmVyIFJvdyBFc3RpbWF0ZSBGYWN0b3InO1xuICAgIFBMQU5ORVJfRVNJTUFURV9ESVJFQ1RJT046IHN0cmluZyA9ICcqUGxhbm5lciBSb3cgRXN0aW1hdGUgRGlyZWN0aW9uJztcblxuICAgIENURV9TQ0FOX1BST1AgPSAnQ1RFIFNjYW4nO1xuICAgIENURV9OQU1FX1BST1AgPSAnQ1RFIE5hbWUnO1xuXG4gICAgQVJSQVlfSU5ERVhfS0VZOiBzdHJpbmcgPSAnYXJyYXlJbmRleCc7XG5cbiAgICBQRVZfUExBTl9UQUc6IHN0cmluZyA9ICdwbGFuXyc7XG5cbiAgICBwcml2YXRlIF9tYXhSb3dzOiBudW1iZXIgPSAwO1xuICAgIHByaXZhdGUgX21heENvc3Q6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBfbWF4RHVyYXRpb246IG51bWJlciA9IDA7XG5cbiAgICBnZXRQbGFucygpOiBBcnJheTxJUGxhbj4ge1xuICAgICAgICB2YXIgcGxhbnM6IEFycmF5PElQbGFuPiA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIGkgaW4gbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgICAgICBpZiAoXy5zdGFydHNXaXRoKGksIHRoaXMuUEVWX1BMQU5fVEFHKSkge1xuICAgICAgICAgICAgICAgIHBsYW5zLnB1c2goSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbaV0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfLmNoYWluKHBsYW5zKVxuICAgICAgICAuc29ydEJ5KCdjcmVhdGVkT24nKVxuICAgICAgICAucmV2ZXJzZSgpXG4gICAgICAgIC52YWx1ZSgpO1xuICAgIH1cblxuICAgIGdldFBsYW4oaWQ6IHN0cmluZyk6IElQbGFuIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oaWQpKTtcbiAgICB9XG5cbiAgICBjcmVhdGVQbGFuKHBsYW5OYW1lOiBzdHJpbmcsIHBsYW5Db250ZW50OiBzdHJpbmcsIHBsYW5RdWVyeSk6IElQbGFuIHtcbiAgICAgICAgdmFyIHBsYW46IElQbGFuID0ge1xuICAgICAgICAgICAgaWQ6IHRoaXMuUEVWX1BMQU5fVEFHICsgbmV3IERhdGUoKS5nZXRUaW1lKCkudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIG5hbWU6IHBsYW5OYW1lIHx8ICdwbGFuIGNyZWF0ZWQgb24gJyArIG1vbWVudCgpLmZvcm1hdCgnTExMJyksXG4gICAgICAgICAgICBjcmVhdGVkT246IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBjb250ZW50OiBKU09OLnBhcnNlKHBsYW5Db250ZW50KVswXSxcbiAgICAgICAgICAgIHF1ZXJ5OiBwbGFuUXVlcnlcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmFuYWx5emVQbGFuKHBsYW4pO1xuICAgICAgICByZXR1cm4gcGxhbjtcbiAgICB9XG5cbiAgICBpc0pzb25TdHJpbmcoc3RyKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBKU09OLnBhcnNlKHN0cik7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBhbmFseXplUGxhbihwbGFuOiBJUGxhbikge1xuICAgICAgICB0aGlzLnByb2Nlc3NOb2RlKHBsYW4uY29udGVudC5QbGFuKTtcbiAgICAgICAgcGxhbi5jb250ZW50W3RoaXMuTUFYSU1VTV9ST1dTX1BST1BdID0gdGhpcy5fbWF4Um93cztcbiAgICAgICAgcGxhbi5jb250ZW50W3RoaXMuTUFYSU1VTV9DT1NUU19QUk9QXSA9IHRoaXMuX21heENvc3Q7XG4gICAgICAgIHBsYW4uY29udGVudFt0aGlzLk1BWElNVU1fRFVSQVRJT05fUFJPUF0gPSB0aGlzLl9tYXhEdXJhdGlvbjtcblxuICAgICAgICB0aGlzLmZpbmRPdXRsaWVyTm9kZXMocGxhbi5jb250ZW50LlBsYW4pO1xuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHBsYW4uaWQsIEpTT04uc3RyaW5naWZ5KHBsYW4pKTtcbiAgICB9XG5cbiAgICBkZWxldGVQbGFuKHBsYW46IElQbGFuKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHBsYW4uaWQpO1xuICAgIH1cblxuICAgIGRlbGV0ZUFsbFBsYW5zKCkge1xuICAgICAgICBsb2NhbFN0b3JhZ2UuY2xlYXIoKTtcbiAgICB9XG5cbiAgICAvLyByZWN1cnNpdmVseSB3YWxrIGRvd24gdGhlIHBsYW4gdG8gY29tcHV0ZSB2YXJpb3VzIG1ldHJpY3NcbiAgICBwcm9jZXNzTm9kZShub2RlKSB7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlUGxhbm5lckVzdGltYXRlKG5vZGUpO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZUFjdHVhbHMobm9kZSk7XG5cbiAgICAgICAgXy5lYWNoKG5vZGUsICh2YWx1ZSwga2V5KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1heGltdW1zKG5vZGUsIGtleSwgdmFsdWUpO1xuXG4gICAgICAgICAgICBpZiAoa2V5ID09PSB0aGlzLlBMQU5TX1BST1ApIHtcbiAgICAgICAgICAgICAgICBfLmVhY2godmFsdWUsICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NOb2RlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlTWF4aW11bXMobm9kZSwga2V5LCB2YWx1ZSkge1xuICAgICAgICBpZiAoa2V5ID09PSB0aGlzLkFDVFVBTF9ST1dTX1BST1AgJiYgdGhpcy5fbWF4Um93cyA8IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9tYXhSb3dzID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PT0gdGhpcy5BQ1RVQUxfQ09TVF9QUk9QICYmIHRoaXMuX21heENvc3QgPCB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fbWF4Q29zdCA9IHZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGtleSA9PT0gdGhpcy5BQ1RVQUxfRFVSQVRJT05fUFJPUCAmJiB0aGlzLl9tYXhEdXJhdGlvbiA8IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9tYXhEdXJhdGlvbiA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZmluZE91dGxpZXJOb2Rlcyhub2RlKSB7XG4gICAgICAgIG5vZGVbdGhpcy5TTE9XRVNUX05PREVfUFJPUF0gPSBmYWxzZTtcbiAgICAgICAgbm9kZVt0aGlzLkxBUkdFU1RfTk9ERV9QUk9QXSA9IGZhbHNlO1xuICAgICAgICBub2RlW3RoaXMuQ09TVExJRVNUX05PREVfUFJPUF0gPSBmYWxzZTtcblxuICAgICAgICBpZiAobm9kZVt0aGlzLkFDVFVBTF9DT1NUX1BST1BdID09PSB0aGlzLl9tYXhDb3N0KSB7XG4gICAgICAgICAgICBub2RlW3RoaXMuQ09TVExJRVNUX05PREVfUFJPUF0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlW3RoaXMuQUNUVUFMX1JPV1NfUFJPUF0gPT09IHRoaXMuX21heFJvd3MpIHtcbiAgICAgICAgICAgIG5vZGVbdGhpcy5MQVJHRVNUX05PREVfUFJPUF0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlW3RoaXMuQUNUVUFMX0RVUkFUSU9OX1BST1BdID09PSB0aGlzLl9tYXhEdXJhdGlvbikge1xuICAgICAgICAgICAgbm9kZVt0aGlzLlNMT1dFU1RfTk9ERV9QUk9QXSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBfLmVhY2gobm9kZSwgKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09IHRoaXMuUExBTlNfUFJPUCkge1xuICAgICAgICAgICAgICAgIF8uZWFjaCh2YWx1ZSwgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZE91dGxpZXJOb2Rlcyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIGFjdHVhbCBkdXJhdGlvbiBhbmQgYWN0dWFsIGNvc3QgYXJlIGNhbGN1bGF0ZWQgYnkgc3VidHJhY3RpbmcgY2hpbGQgdmFsdWVzIGZyb20gdGhlIHRvdGFsXG4gICAgY2FsY3VsYXRlQWN0dWFscyhub2RlKSB7XG4gICAgICAgIG5vZGVbdGhpcy5BQ1RVQUxfRFVSQVRJT05fUFJPUF0gPSBub2RlW3RoaXMuQUNUVUFMX1RPVEFMX1RJTUVfUFJPUF07XG4gICAgICAgIG5vZGVbdGhpcy5BQ1RVQUxfQ09TVF9QUk9QXSA9IG5vZGVbdGhpcy5UT1RBTF9DT1NUX1BST1BdO1xuXG4gICAgICAgIGNvbnNvbGUubG9nIChub2RlKTtcbiAgICAgICAgXy5lYWNoKG5vZGUuUGxhbnMsIHN1YlBsYW4gPT4ge1xuICAgICAgICAgICBjb25zb2xlLmxvZygncHJvY2Vzc2luZyBjaGxkcmVuJywgc3ViUGxhbilcbiAgICAgICAgICAgLy8gc2luY2UgQ1RFIHNjYW4gZHVyYXRpb24gaXMgYWxyZWFkeSBpbmNsdWRlZCBpbiBpdHMgc3Vibm9kZXMsIGl0IHNob3VsZCBiZSBiZVxuICAgICAgICAgICAvLyBzdWJ0cmFjdGVkIGZyb20gdGhlIGR1cmF0aW9uIG9mIHRoaXMgbm9kZVxuICAgICAgICAgICAgaWYgKHN1YlBsYW5bdGhpcy5OT0RFX1RZUEVfUFJPUF0gIT09IHRoaXMuQ1RFX1NDQU5fUFJPUCkge1xuICAgICAgICAgICAgICAgbm9kZVt0aGlzLkFDVFVBTF9EVVJBVElPTl9QUk9QXSA9IG5vZGVbdGhpcy5BQ1RVQUxfRFVSQVRJT05fUFJPUF0gLSBzdWJQbGFuW3RoaXMuQUNUVUFMX1RPVEFMX1RJTUVfUFJPUF07XG4gICAgICAgICAgICAgICBub2RlW3RoaXMuQUNUVUFMX0NPU1RfUFJPUF0gPSBub2RlW3RoaXMuQUNUVUFMX0NPU1RfUFJPUF0gLSBzdWJQbGFuW3RoaXMuVE9UQUxfQ09TVF9QUk9QXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKG5vZGVbdGhpcy5BQ1RVQUxfQ09TVF9QUk9QXSA8IDApIHtcbiAgICAgICAgICAgIG5vZGVbdGhpcy5BQ1RVQUxfQ09TVF9QUk9QXSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzaW5jZSB0aW1lIGlzIHJlcG9ydGVkIGZvciBhbiBpbnZpZHVhbCBsb29wLCBhY3R1YWwgZHVyYXRpb24gbXVzdCBiZSBhZGp1c3RlZCBieSBudW1iZXIgb2YgbG9vcHNcbiAgICAgICAgbm9kZVt0aGlzLkFDVFVBTF9EVVJBVElPTl9QUk9QXSA9IG5vZGVbdGhpcy5BQ1RVQUxfRFVSQVRJT05fUFJPUF0gKiBub2RlW3RoaXMuQUNUVUFMX0xPT1BTX1BST1BdO1xuICAgIH1cblxuICAgIC8vIGZpZ3VyZSBvdXQgb3JkZXIgb2YgbWFnbml0dWRlIGJ5IHdoaWNoIHRoZSBwbGFubmVyIG1pcy1lc3RpbWF0ZWQgaG93IG1hbnkgcm93cyB3b3VsZCBiZVxuICAgIC8vIGludmxvdmVkIGluIHRoaXMgbm9kZVxuICAgIGNhbGN1bGF0ZVBsYW5uZXJFc3RpbWF0ZShub2RlKSB7XG4gICAgICAgIG5vZGVbdGhpcy5QTEFOTkVSX0VTVElNQVRFX0ZBQ1RPUl0gPSBub2RlW3RoaXMuQUNUVUFMX1JPV1NfUFJPUF0gLyBub2RlW3RoaXMuUExBTl9ST1dTX1BST1BdO1xuICAgICAgICBub2RlW3RoaXMuUExBTk5FUl9FU0lNQVRFX0RJUkVDVElPTl0gPSBFc3RpbWF0ZURpcmVjdGlvbi51bmRlcjtcblxuICAgICAgICBpZiAobm9kZVt0aGlzLlBMQU5ORVJfRVNUSU1BVEVfRkFDVE9SXSA8IDEpIHtcbiAgICAgICAgICAgIG5vZGVbdGhpcy5QTEFOTkVSX0VTSU1BVEVfRElSRUNUSU9OXSA9IEVzdGltYXRlRGlyZWN0aW9uLm92ZXI7XG4gICAgICAgICAgICBub2RlW3RoaXMuUExBTk5FUl9FU1RJTUFURV9GQUNUT1JdID0gbm9kZVt0aGlzLlBMQU5fUk9XU19QUk9QXSAvIG5vZGVbdGhpcy5BQ1RVQUxfUk9XU19QUk9QXTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==