var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('angular2/core');
var enums_1 = require('../../enums');
var pipes_1 = require('../../pipes');
var plan_service_1 = require('../../services/plan-service');
var syntax_highlight_service_1 = require('../../services/syntax-highlight-service');
var help_service_1 = require('../../services/help-service');
var color_service_1 = require('../../services/color-service');
var PlanNode = (function () {
    function PlanNode(_planService, _syntaxHighlightService, _helpService, _colorService) {
        this._planService = _planService;
        this._syntaxHighlightService = _syntaxHighlightService;
        this._helpService = _helpService;
        this._colorService = _colorService;
        this.NORMAL_WIDTH = 220;
        this.COMPACT_WIDTH = 140;
        this.DOT_WIDTH = 30;
        this.EXPANDED_WIDTH = 400;
        this.MIN_ESTIMATE_MISS = 100;
        this.COSTLY_TAG = 'costliest';
        this.SLOW_TAG = 'slowest';
        this.LARGE_TAG = 'largest';
        this.ESTIMATE_TAG = 'bad estimate';
        this.estimateDirections = enums_1.EstimateDirection;
        this.highlightTypes = enums_1.HighlightType;
        this.viewModes = enums_1.ViewMode;
    }
    PlanNode.prototype.ngOnInit = function () {
        this.currentHighlightType = this.viewOptions.highlightType;
        this.calculateBar();
        this.calculateProps();
        this.calculateDuration();
        this.calculateTags();
        this.plannerRowEstimateDirection = this.node[this._planService.PLANNER_ESIMATE_DIRECTION];
        this.plannerRowEstimateValue = _.round(this.node[this._planService.PLANNER_ESTIMATE_FACTOR]);
    };
    PlanNode.prototype.ngDoCheck = function () {
        if (this.currentHighlightType !== this.viewOptions.highlightType) {
            this.currentHighlightType = this.viewOptions.highlightType;
            this.calculateBar();
        }
        if (this.currentCompactView !== this.viewOptions.showCompactView) {
            this.currentCompactView = this.viewOptions.showCompactView;
            this.calculateBar();
        }
        if (this.currentExpandedView !== this.showDetails) {
            this.currentExpandedView = this.showDetails;
            this.calculateBar();
        }
    };
    PlanNode.prototype.getFormattedQuery = function () {
        var keyItems = [];
        var relationName = this.node[this._planService.RELATION_NAME_PROP];
        if (relationName) {
            keyItems.push(this.node[this._planService.SCHEMA_PROP] + '.' + relationName);
            keyItems.push(' ' + relationName);
            keyItems.push(' ' + this.node[this._planService.ALIAS_PROP] + ' ');
        }
        var groupKey = this.node[this._planService.GROUP_KEY_PROP];
        if (groupKey) {
            keyItems.push('GROUP BY ' + groupKey.join(','));
        }
        var hashCondition = this.node[this._planService.HASH_CONDITION_PROP];
        if (hashCondition) {
            keyItems.push(hashCondition.replace('(', '').replace(')', ''));
        }
        if (this.node[this._planService.NODE_TYPE_PROP].toUpperCase() === 'LIMIT') {
            keyItems.push('LIMIT');
        }
        return this._syntaxHighlightService.highlight(this.plan.query, keyItems);
    };
    PlanNode.prototype.calculateBar = function () {
        switch (this.viewOptions.viewMode) {
            case enums_1.ViewMode.DOT:
                this.barContainerWidth = this.DOT_WIDTH;
                break;
            case enums_1.ViewMode.COMPACT:
                this.barContainerWidth = this.COMPACT_WIDTH;
                break;
            default:
                this.barContainerWidth = this.NORMAL_WIDTH;
                break;
        }
        if (this.currentExpandedView) {
            this.barContainerWidth = this.EXPANDED_WIDTH;
        }
        switch (this.currentHighlightType) {
            case enums_1.HighlightType.DURATION:
                this.highlightValue = (this.node[this._planService.ACTUAL_DURATION_PROP]);
                this.barWidth = Math.round((this.highlightValue / this.plan.planStats.maxDuration) * this.barContainerWidth);
                break;
            case enums_1.HighlightType.ROWS:
                this.highlightValue = (this.node[this._planService.ACTUAL_ROWS_PROP]);
                this.barWidth = Math.round((this.highlightValue / this.plan.planStats.maxRows) * this.barContainerWidth);
                break;
            case enums_1.HighlightType.COST:
                this.highlightValue = (this.node[this._planService.ACTUAL_COST_PROP]);
                this.barWidth = Math.round((this.highlightValue / this.plan.planStats.maxCost) * this.barContainerWidth);
                break;
        }
        if (this.barWidth < 1) {
            this.barWidth = 1;
        }
        this.backgroundColor = this._colorService.numberToColorHsl(1 - this.barWidth / this.barContainerWidth);
    };
    PlanNode.prototype.calculateDuration = function () {
        this.executionTimePercent = (_.round((this.node[this._planService.ACTUAL_DURATION_PROP] / this.plan.planStats.executionTime) * 100));
    };
    PlanNode.prototype.calculateProps = function () {
        this.props = _.chain(this.node)
            .omit(this._planService.PLANS_PROP)
            .map(function (value, key) {
            return { key: key, value: value };
        })
            .value();
    };
    PlanNode.prototype.calculateTags = function () {
        this.tags = [];
        if (this.node[this._planService.SLOWEST_NODE_PROP]) {
            this.tags.push(this.SLOW_TAG);
        }
        if (this.node[this._planService.COSTLIEST_NODE_PROP]) {
            this.tags.push(this.COSTLY_TAG);
        }
        if (this.node[this._planService.LARGEST_NODE_PROP]) {
            this.tags.push(this.LARGE_TAG);
        }
        if (this.node[this._planService.PLANNER_ESTIMATE_FACTOR] >= this.MIN_ESTIMATE_MISS) {
            this.tags.push(this.ESTIMATE_TAG);
        }
    };
    PlanNode.prototype.getNodeTypeDescription = function () {
        return this._helpService.getNodeTypeDescription(this.node[this._planService.NODE_TYPE_PROP]);
    };
    PlanNode.prototype.getNodeName = function () {
        if (this.viewOptions.viewMode === enums_1.ViewMode.DOT && !this.showDetails) {
            return this.node[this._planService.NODE_TYPE_PROP].replace(/[^A-Z]/g, '').toUpperCase();
        }
        return (this.node[this._planService.NODE_TYPE_PROP]).toUpperCase();
    };
    PlanNode.prototype.getTagName = function (tagName) {
        if (this.viewOptions.viewMode === enums_1.ViewMode.DOT && !this.showDetails) {
            return tagName.charAt(0);
        }
        return tagName;
    };
    PlanNode.prototype.shouldShowPlannerEstimate = function () {
        if (this.viewOptions.showPlannerEstimate && this.showDetails) {
            return true;
        }
        if (this.viewOptions.viewMode === enums_1.ViewMode.DOT) {
            return false;
        }
        return this.viewOptions.showPlannerEstimate;
    };
    PlanNode.prototype.shouldShowNodeBarLabel = function () {
        if (this.showDetails) {
            return true;
        }
        if (this.viewOptions.viewMode === enums_1.ViewMode.DOT) {
            return false;
        }
        return true;
    };
    PlanNode = __decorate([
        core_1.Component({
            selector: 'plan-node',
            inputs: ['plan', 'node', 'viewOptions'],
            template: "\n      <div class=\"plan-node\"\n         [class.expanded]=\"showDetails\"\n         [class.compact]=\"viewOptions.viewMode === viewModes.COMPACT\"\n         [class.dot]=\"viewOptions.viewMode === viewModes.DOT\">\n\n         <header (click)=\"showDetails = !showDetails\" tooltip=\"view node details\">\n            <h4>{{getNodeName()}}</h4>\n            <span *ngIf=\"viewOptions.viewMode === viewModes.FULL || showDetails\">\n               <span class=\"node-duration\">{{node[_planService.ACTUAL_DURATION_PROP] | duration}}<span class=\"text-muted\">{{node[_planService.ACTUAL_DURATION_PROP] | durationUnit}}\n                   | </span><strong>{{executionTimePercent}}</strong>\n                  <span class=\"text-muted\">%</span>\n               </span>\n            </span>\n         </header>\n\n         <button *ngIf=\"plan.query && viewOptions.viewMode === viewModes.FULL\" tooltip=\"view corresponding query\"\n            class=\"btn btn-sm btn-default btn-slim pull-right\" (click)=\"showQuery = !showQuery\">\n            <i class=\"fa fa-database\"></i>\n         </button>\n\n         <div *ngIf=\"viewOptions.viewMode === viewModes.FULL\">\n            <div class=\"relation-name\" *ngIf=\"node[_planService.RELATION_NAME_PROP]\">\n               <span class=\"text-muted\">on </span>\n               <span *ngIf=\"node[_planService.SCHEMA_PROP]\">{{node[_planService.SCHEMA_PROP]}}.</span>{{node[_planService.RELATION_NAME_PROP]}}\n               <span *ngIf=\"node[_planService.ALIAS_PROP]\"> ({{node[_planService.ALIAS_PROP]}})</span>\n            </div>\n\n            <div class=\"relation-name\" *ngIf=\"node[_planService.GROUP_KEY_PROP]\">\n               <span class=\"text-muted\">by</span> {{node[_planService.GROUP_KEY_PROP]}}</div>\n            <div class=\"relation-name\" *ngIf=\"node[_planService.SORT_KEY_PROP]\">\n               <span class=\"text-muted\">by</span> {{node[_planService.SORT_KEY_PROP]}}</div>\n            <div class=\"relation-name\" *ngIf=\"node[_planService.JOIN_TYPE_PROP]\">{{node[_planService.JOIN_TYPE_PROP]}}\n               <span class=\"text-muted\">join</span></div>\n            <div class=\"relation-name\" *ngIf=\"node[_planService.INDEX_NAME_PROP]\"><span class=\"text-muted\">\n               using</span> {{node[_planService.INDEX_NAME_PROP]}}</div>\n            <div class=\"relation-name\" *ngIf=\"node[_planService.HASH_CONDITION_PROP]\"><span class=\"text-muted\">\n               on</span> {{node[_planService.HASH_CONDITION_PROP]}}</div>\n            <div class=\"relation-name\" *ngIf=\"node[_planService.CTE_NAME_PROP]\">\n                  <span class=\"text-muted\">CTE</span> {{node[_planService.CTE_NAME_PROP]}}\n            </div>\n         </div>\n\n         <div class=\"tags\" *ngIf=\"viewOptions.showTags && tags.length > 0\">\n            <span *ngFor=\"#tag of tags\">{{getTagName(tag)}}</span>\n         </div>\n\n         <div *ngIf=\"currentHighlightType !== highlightTypes.NONE\">\n            <div class=\"node-bar-container\">\n               <span class=\"node-bar\" [style.width]=\"barWidth+'px'\" [style.backgroundColor]=\"backgroundColor\"></span>\n            </div>\n            <span class=\"node-bar-label\" *ngIf=\"shouldShowNodeBarLabel()\">\n               <span class=\"text-muted\">{{viewOptions.highlightType}}:</span> {{highlightValue | number:'.0-2'}}\n            </span>\n         </div>\n\n         <div class=\"planner-estimate\" *ngIf=\"shouldShowPlannerEstimate()\">\n            <span *ngIf=\"plannerRowEstimateDirection === estimateDirections.over\"><strong>over</strong> estimated rows</span>\n            <span *ngIf=\"plannerRowEstimateDirection === estimateDirections.under\"><strong>under</strong> estimated rows</span>\n            <span> by <strong>{{plannerRowEstimateValue | number}}</strong>x</span>\n         </div>\n\n         <div *ngIf=\"showDetails\">\n            <div *ngIf=\"getNodeTypeDescription()\" class=\"node-description\">\n               <span class=\"node-type\">{{node[_planService.NODE_TYPE_PROP]}} Node</span> <span [innerHtml]=\"getNodeTypeDescription()\"></span>\n            </div>\n\n            <table class=\"table prop-list\">\n               <tr *ngFor=\"#prop of props\">\n                  <td width=\"40%\">{{prop.key}}</td>\n                  <td>{{prop.value}}</td>\n               <tr>\n            </table>\n            <div class=\"text-muted pad-top align-right\"><em>*Pev calculated value</em></div>\n         </div>\n\n         <div *ngIf=\"showQuery\" class=\"plan-query-container\">\n            <button class=\"btn btn-close pull-right\" (click)=\"showQuery = false\">\n               <i class=\"fa fa-close\"></i>\n            </button>\n            <h3>query</h3>\n            <pre class=\"plan-query-text\"><code [innerHTML]=\"getFormattedQuery()\"></code></pre>\n         </div>\n      </div>\n\n      <ul *ngIf=\"node.Plans\">\n        <li *ngFor=\"#subNode of node.Plans\">\n          <plan-node [plan]=\"plan\" [node]=\"subNode\" [viewOptions]=\"viewOptions\" [planStats]=\"planStats\"></plan-node>\n        </li>\n      </ul>\n    ",
            directives: [PlanNode],
            providers: [plan_service_1.PlanService, syntax_highlight_service_1.SyntaxHighlightService, help_service_1.HelpService, color_service_1.ColorService],
            pipes: [pipes_1.DurationPipe, pipes_1.DurationUnitPipe]
        }), 
        __metadata('design:paramtypes', [plan_service_1.PlanService, syntax_highlight_service_1.SyntaxHighlightService, help_service_1.HelpService, color_service_1.ColorService])
    ], PlanNode);
    return PlanNode;
})();
exports.PlanNode = PlanNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvcGxhbi1ub2RlL3BsYW4tbm9kZS50cyJdLCJuYW1lcyI6WyJQbGFuTm9kZSIsIlBsYW5Ob2RlLmNvbnN0cnVjdG9yIiwiUGxhbk5vZGUubmdPbkluaXQiLCJQbGFuTm9kZS5uZ0RvQ2hlY2siLCJQbGFuTm9kZS5nZXRGb3JtYXR0ZWRRdWVyeSIsIlBsYW5Ob2RlLmNhbGN1bGF0ZUJhciIsIlBsYW5Ob2RlLmNhbGN1bGF0ZUR1cmF0aW9uIiwiUGxhbk5vZGUuY2FsY3VsYXRlUHJvcHMiLCJQbGFuTm9kZS5jYWxjdWxhdGVUYWdzIiwiUGxhbk5vZGUuZ2V0Tm9kZVR5cGVEZXNjcmlwdGlvbiIsIlBsYW5Ob2RlLmdldE5vZGVOYW1lIiwiUGxhbk5vZGUuZ2V0VGFnTmFtZSIsIlBsYW5Ob2RlLnNob3VsZFNob3dQbGFubmVyRXN0aW1hdGUiLCJQbGFuTm9kZS5zaG91bGRTaG93Tm9kZUJhckxhYmVsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFDQSxxQkFBZ0MsZUFBZSxDQUFDLENBQUE7QUFDaEQsc0JBQXlELGFBQWEsQ0FBQyxDQUFBO0FBQ3ZFLHNCQUE2QyxhQUFhLENBQUMsQ0FBQTtBQUUzRCw2QkFBMEIsNkJBQTZCLENBQUMsQ0FBQTtBQUN4RCx5Q0FBcUMseUNBQXlDLENBQUMsQ0FBQTtBQUMvRSw2QkFBMEIsNkJBQTZCLENBQUMsQ0FBQTtBQUN4RCw4QkFBMkIsOEJBQThCLENBQUMsQ0FBQTtBQUkxRDtJQTZJSUEsa0JBQW9CQSxZQUF5QkEsRUFDakNBLHVCQUErQ0EsRUFDL0NBLFlBQXlCQSxFQUN6QkEsYUFBMkJBO1FBSG5CQyxpQkFBWUEsR0FBWkEsWUFBWUEsQ0FBYUE7UUFDakNBLDRCQUF1QkEsR0FBdkJBLHVCQUF1QkEsQ0FBd0JBO1FBQy9DQSxpQkFBWUEsR0FBWkEsWUFBWUEsQ0FBYUE7UUFDekJBLGtCQUFhQSxHQUFiQSxhQUFhQSxDQUFjQTtRQTNDdkNBLGlCQUFZQSxHQUFXQSxHQUFHQSxDQUFDQTtRQUMzQkEsa0JB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LEFBMlRDQSxJQUFBO0FBeE5ZLGdCQUFRLFdBd05wQixDQUFBIiwiZmlsZSI6ImNvbXBvbmVudHMvcGxhbi1ub2RlL3BsYW4tbm9kZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SVBsYW59IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvaXBsYW4nO1xuaW1wb3J0IHtDb21wb25lbnQsIE9uSW5pdH0gZnJvbSAnYW5ndWxhcjIvY29yZSc7XG5pbXBvcnQge0hpZ2hsaWdodFR5cGUsIEVzdGltYXRlRGlyZWN0aW9uLCBWaWV3TW9kZX0gZnJvbSAnLi4vLi4vZW51bXMnO1xuaW1wb3J0IHtEdXJhdGlvblBpcGUsIER1cmF0aW9uVW5pdFBpcGV9IGZyb20gJy4uLy4uL3BpcGVzJztcblxuaW1wb3J0IHtQbGFuU2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvcGxhbi1zZXJ2aWNlJztcbmltcG9ydCB7U3ludGF4SGlnaGxpZ2h0U2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3ludGF4LWhpZ2hsaWdodC1zZXJ2aWNlJztcbmltcG9ydCB7SGVscFNlcnZpY2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2hlbHAtc2VydmljZSc7XG5pbXBvcnQge0NvbG9yU2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvY29sb3Itc2VydmljZSc7XG5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJsb2Rhc2guZC50c1wiIC8+XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAncGxhbi1ub2RlJyxcbiAgICBpbnB1dHM6IFsncGxhbicsICdub2RlJywgJ3ZpZXdPcHRpb25zJ10sXG4gICAgdGVtcGxhdGU6IGBcbiAgICAgIDxkaXYgY2xhc3M9XCJwbGFuLW5vZGVcIlxuICAgICAgICAgW2NsYXNzLmV4cGFuZGVkXT1cInNob3dEZXRhaWxzXCJcbiAgICAgICAgIFtjbGFzcy5jb21wYWN0XT1cInZpZXdPcHRpb25zLnZpZXdNb2RlID09PSB2aWV3TW9kZXMuQ09NUEFDVFwiXG4gICAgICAgICBbY2xhc3MuZG90XT1cInZpZXdPcHRpb25zLnZpZXdNb2RlID09PSB2aWV3TW9kZXMuRE9UXCI+XG5cbiAgICAgICAgIDxoZWFkZXIgKGNsaWNrKT1cInNob3dEZXRhaWxzID0gIXNob3dEZXRhaWxzXCIgdG9vbHRpcD1cInZpZXcgbm9kZSBkZXRhaWxzXCI+XG4gICAgICAgICAgICA8aDQ+e3tnZXROb2RlTmFtZSgpfX08L2g0PlxuICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJ2aWV3T3B0aW9ucy52aWV3TW9kZSA9PT0gdmlld01vZGVzLkZVTEwgfHwgc2hvd0RldGFpbHNcIj5cbiAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibm9kZS1kdXJhdGlvblwiPnt7bm9kZVtfcGxhblNlcnZpY2UuQUNUVUFMX0RVUkFUSU9OX1BST1BdIHwgZHVyYXRpb259fTxzcGFuIGNsYXNzPVwidGV4dC1tdXRlZFwiPnt7bm9kZVtfcGxhblNlcnZpY2UuQUNUVUFMX0RVUkFUSU9OX1BST1BdIHwgZHVyYXRpb25Vbml0fX1cbiAgICAgICAgICAgICAgICAgICB8IDwvc3Bhbj48c3Ryb25nPnt7ZXhlY3V0aW9uVGltZVBlcmNlbnR9fTwvc3Ryb25nPlxuICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0ZXh0LW11dGVkXCI+JTwvc3Bhbj5cbiAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgIDwvaGVhZGVyPlxuXG4gICAgICAgICA8YnV0dG9uICpuZ0lmPVwicGxhbi5xdWVyeSAmJiB2aWV3T3B0aW9ucy52aWV3TW9kZSA9PT0gdmlld01vZGVzLkZVTExcIiB0b29sdGlwPVwidmlldyBjb3JyZXNwb25kaW5nIHF1ZXJ5XCJcbiAgICAgICAgICAgIGNsYXNzPVwiYnRuIGJ0bi1zbSBidG4tZGVmYXVsdCBidG4tc2xpbSBwdWxsLXJpZ2h0XCIgKGNsaWNrKT1cInNob3dRdWVyeSA9ICFzaG93UXVlcnlcIj5cbiAgICAgICAgICAgIDxpIGNsYXNzPVwiZmEgZmEtZGF0YWJhc2VcIj48L2k+XG4gICAgICAgICA8L2J1dHRvbj5cblxuICAgICAgICAgPGRpdiAqbmdJZj1cInZpZXdPcHRpb25zLnZpZXdNb2RlID09PSB2aWV3TW9kZXMuRlVMTFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJlbGF0aW9uLW5hbWVcIiAqbmdJZj1cIm5vZGVbX3BsYW5TZXJ2aWNlLlJFTEFUSU9OX05BTUVfUFJPUF1cIj5cbiAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dC1tdXRlZFwiPm9uIDwvc3Bhbj5cbiAgICAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwibm9kZVtfcGxhblNlcnZpY2UuU0NIRU1BX1BST1BdXCI+e3tub2RlW19wbGFuU2VydmljZS5TQ0hFTUFfUFJPUF19fS48L3NwYW4+e3tub2RlW19wbGFuU2VydmljZS5SRUxBVElPTl9OQU1FX1BST1BdfX1cbiAgICAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwibm9kZVtfcGxhblNlcnZpY2UuQUxJQVNfUFJPUF1cIj4gKHt7bm9kZVtfcGxhblNlcnZpY2UuQUxJQVNfUFJPUF19fSk8L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJlbGF0aW9uLW5hbWVcIiAqbmdJZj1cIm5vZGVbX3BsYW5TZXJ2aWNlLkdST1VQX0tFWV9QUk9QXVwiPlxuICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0ZXh0LW11dGVkXCI+Ynk8L3NwYW4+IHt7bm9kZVtfcGxhblNlcnZpY2UuR1JPVVBfS0VZX1BST1BdfX08L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZWxhdGlvbi1uYW1lXCIgKm5nSWY9XCJub2RlW19wbGFuU2VydmljZS5TT1JUX0tFWV9QUk9QXVwiPlxuICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0ZXh0LW11dGVkXCI+Ynk8L3NwYW4+IHt7bm9kZVtfcGxhblNlcnZpY2UuU09SVF9LRVlfUFJPUF19fTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJlbGF0aW9uLW5hbWVcIiAqbmdJZj1cIm5vZGVbX3BsYW5TZXJ2aWNlLkpPSU5fVFlQRV9QUk9QXVwiPnt7bm9kZVtfcGxhblNlcnZpY2UuSk9JTl9UWVBFX1BST1BdfX1cbiAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dC1tdXRlZFwiPmpvaW48L3NwYW4+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmVsYXRpb24tbmFtZVwiICpuZ0lmPVwibm9kZVtfcGxhblNlcnZpY2UuSU5ERVhfTkFNRV9QUk9QXVwiPjxzcGFuIGNsYXNzPVwidGV4dC1tdXRlZFwiPlxuICAgICAgICAgICAgICAgdXNpbmc8L3NwYW4+IHt7bm9kZVtfcGxhblNlcnZpY2UuSU5ERVhfTkFNRV9QUk9QXX19PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmVsYXRpb24tbmFtZVwiICpuZ0lmPVwibm9kZVtfcGxhblNlcnZpY2UuSEFTSF9DT05ESVRJT05fUFJPUF1cIj48c3BhbiBjbGFzcz1cInRleHQtbXV0ZWRcIj5cbiAgICAgICAgICAgICAgIG9uPC9zcGFuPiB7e25vZGVbX3BsYW5TZXJ2aWNlLkhBU0hfQ09ORElUSU9OX1BST1BdfX08L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZWxhdGlvbi1uYW1lXCIgKm5nSWY9XCJub2RlW19wbGFuU2VydmljZS5DVEVfTkFNRV9QUk9QXVwiPlxuICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0ZXh0LW11dGVkXCI+Q1RFPC9zcGFuPiB7e25vZGVbX3BsYW5TZXJ2aWNlLkNURV9OQU1FX1BST1BdfX1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgIDxkaXYgY2xhc3M9XCJ0YWdzXCIgKm5nSWY9XCJ2aWV3T3B0aW9ucy5zaG93VGFncyAmJiB0YWdzLmxlbmd0aCA+IDBcIj5cbiAgICAgICAgICAgIDxzcGFuICpuZ0Zvcj1cIiN0YWcgb2YgdGFnc1wiPnt7Z2V0VGFnTmFtZSh0YWcpfX08L3NwYW4+XG4gICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgPGRpdiAqbmdJZj1cImN1cnJlbnRIaWdobGlnaHRUeXBlICE9PSBoaWdobGlnaHRUeXBlcy5OT05FXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibm9kZS1iYXItY29udGFpbmVyXCI+XG4gICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm5vZGUtYmFyXCIgW3N0eWxlLndpZHRoXT1cImJhcldpZHRoKydweCdcIiBbc3R5bGUuYmFja2dyb3VuZENvbG9yXT1cImJhY2tncm91bmRDb2xvclwiPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJub2RlLWJhci1sYWJlbFwiICpuZ0lmPVwic2hvdWxkU2hvd05vZGVCYXJMYWJlbCgpXCI+XG4gICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRleHQtbXV0ZWRcIj57e3ZpZXdPcHRpb25zLmhpZ2hsaWdodFR5cGV9fTo8L3NwYW4+IHt7aGlnaGxpZ2h0VmFsdWUgfCBudW1iZXI6Jy4wLTInfX1cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICA8ZGl2IGNsYXNzPVwicGxhbm5lci1lc3RpbWF0ZVwiICpuZ0lmPVwic2hvdWxkU2hvd1BsYW5uZXJFc3RpbWF0ZSgpXCI+XG4gICAgICAgICAgICA8c3BhbiAqbmdJZj1cInBsYW5uZXJSb3dFc3RpbWF0ZURpcmVjdGlvbiA9PT0gZXN0aW1hdGVEaXJlY3Rpb25zLm92ZXJcIj48c3Ryb25nPm92ZXI8L3N0cm9uZz4gZXN0aW1hdGVkIHJvd3M8L3NwYW4+XG4gICAgICAgICAgICA8c3BhbiAqbmdJZj1cInBsYW5uZXJSb3dFc3RpbWF0ZURpcmVjdGlvbiA9PT0gZXN0aW1hdGVEaXJlY3Rpb25zLnVuZGVyXCI+PHN0cm9uZz51bmRlcjwvc3Ryb25nPiBlc3RpbWF0ZWQgcm93czwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuPiBieSA8c3Ryb25nPnt7cGxhbm5lclJvd0VzdGltYXRlVmFsdWUgfCBudW1iZXJ9fTwvc3Ryb25nPng8L3NwYW4+XG4gICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgPGRpdiAqbmdJZj1cInNob3dEZXRhaWxzXCI+XG4gICAgICAgICAgICA8ZGl2ICpuZ0lmPVwiZ2V0Tm9kZVR5cGVEZXNjcmlwdGlvbigpXCIgY2xhc3M9XCJub2RlLWRlc2NyaXB0aW9uXCI+XG4gICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm5vZGUtdHlwZVwiPnt7bm9kZVtfcGxhblNlcnZpY2UuTk9ERV9UWVBFX1BST1BdfX0gTm9kZTwvc3Bhbj4gPHNwYW4gW2lubmVySHRtbF09XCJnZXROb2RlVHlwZURlc2NyaXB0aW9uKClcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPHRhYmxlIGNsYXNzPVwidGFibGUgcHJvcC1saXN0XCI+XG4gICAgICAgICAgICAgICA8dHIgKm5nRm9yPVwiI3Byb3Agb2YgcHJvcHNcIj5cbiAgICAgICAgICAgICAgICAgIDx0ZCB3aWR0aD1cIjQwJVwiPnt7cHJvcC5rZXl9fTwvdGQ+XG4gICAgICAgICAgICAgICAgICA8dGQ+e3twcm9wLnZhbHVlfX08L3RkPlxuICAgICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgPC90YWJsZT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0LW11dGVkIHBhZC10b3AgYWxpZ24tcmlnaHRcIj48ZW0+KlBldiBjYWxjdWxhdGVkIHZhbHVlPC9lbT48L2Rpdj5cbiAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICA8ZGl2ICpuZ0lmPVwic2hvd1F1ZXJ5XCIgY2xhc3M9XCJwbGFuLXF1ZXJ5LWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tY2xvc2UgcHVsbC1yaWdodFwiIChjbGljayk9XCJzaG93UXVlcnkgPSBmYWxzZVwiPlxuICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1jbG9zZVwiPjwvaT5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPGgzPnF1ZXJ5PC9oMz5cbiAgICAgICAgICAgIDxwcmUgY2xhc3M9XCJwbGFuLXF1ZXJ5LXRleHRcIj48Y29kZSBbaW5uZXJIVE1MXT1cImdldEZvcm1hdHRlZFF1ZXJ5KClcIj48L2NvZGU+PC9wcmU+XG4gICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8dWwgKm5nSWY9XCJub2RlLlBsYW5zXCI+XG4gICAgICAgIDxsaSAqbmdGb3I9XCIjc3ViTm9kZSBvZiBub2RlLlBsYW5zXCI+XG4gICAgICAgICAgPHBsYW4tbm9kZSBbcGxhbl09XCJwbGFuXCIgW25vZGVdPVwic3ViTm9kZVwiIFt2aWV3T3B0aW9uc109XCJ2aWV3T3B0aW9uc1wiIFtwbGFuU3RhdHNdPVwicGxhblN0YXRzXCI+PC9wbGFuLW5vZGU+XG4gICAgICAgIDwvbGk+XG4gICAgICA8L3VsPlxuICAgIGAsXG4gICAgZGlyZWN0aXZlczogW1BsYW5Ob2RlXSxcbiAgICBwcm92aWRlcnM6IFtQbGFuU2VydmljZSwgU3ludGF4SGlnaGxpZ2h0U2VydmljZSwgSGVscFNlcnZpY2UsIENvbG9yU2VydmljZV0sXG4gICAgcGlwZXM6IFtEdXJhdGlvblBpcGUsIER1cmF0aW9uVW5pdFBpcGVdXG59KVxuXG5leHBvcnQgY2xhc3MgUGxhbk5vZGUge1xuICAgIC8vIGNvbnN0c1xuICAgIE5PUk1BTF9XSURUSDogbnVtYmVyID0gMjIwO1xuICAgIENPTVBBQ1RfV0lEVEg6IG51bWJlciA9IDE0MDtcbiAgICBET1RfV0lEVEg6IG51bWJlciA9IDMwO1xuICAgIEVYUEFOREVEX1dJRFRIOiBudW1iZXIgPSA0MDA7XG5cbiAgICBNSU5fRVNUSU1BVEVfTUlTUzogbnVtYmVyID0gMTAwO1xuICAgIENPU1RMWV9UQUc6IHN0cmluZyA9ICdjb3N0bGllc3QnO1xuICAgIFNMT1dfVEFHOiBzdHJpbmcgPSAnc2xvd2VzdCc7XG4gICAgTEFSR0VfVEFHOiBzdHJpbmcgPSAnbGFyZ2VzdCc7XG4gICAgRVNUSU1BVEVfVEFHOiBzdHJpbmcgPSAnYmFkIGVzdGltYXRlJztcblxuICAgIC8vIGlucHV0c1xuICAgIHBsYW46IElQbGFuO1xuICAgIG5vZGU6IGFueTtcbiAgICB2aWV3T3B0aW9uczogYW55O1xuXG4gICAgLy8gVUkgZmxhZ3NcbiAgICBzaG93RGV0YWlsczogYm9vbGVhbjtcblxuICAgIC8vIGNhbGN1bGF0ZWQgcHJvcGVydGllc1xuICAgIGV4ZWN1dGlvblRpbWVQZXJjZW50OiBudW1iZXI7XG4gICAgYmFja2dyb3VuZENvbG9yOiBzdHJpbmc7XG4gICAgaGlnaGxpZ2h0VmFsdWU6IG51bWJlcjtcbiAgICBiYXJDb250YWluZXJXaWR0aDogbnVtYmVyO1xuICAgIGJhcldpZHRoOiBudW1iZXI7XG4gICAgcHJvcHM6IEFycmF5PGFueT47XG4gICAgdGFnczogQXJyYXk8c3RyaW5nPjtcbiAgICBwbGFubmVyUm93RXN0aW1hdGVWYWx1ZTogbnVtYmVyO1xuICAgIHBsYW5uZXJSb3dFc3RpbWF0ZURpcmVjdGlvbjogRXN0aW1hdGVEaXJlY3Rpb247XG5cbiAgICAvLyByZXF1aXJlZCBmb3IgY3VzdG9tIGNoYW5nZSBkZXRlY3Rpb25cbiAgICBjdXJyZW50SGlnaGxpZ2h0VHlwZTogc3RyaW5nO1xuICAgIGN1cnJlbnRDb21wYWN0VmlldzogYm9vbGVhbjtcbiAgICBjdXJyZW50RXhwYW5kZWRWaWV3OiBib29sZWFuO1xuXG4gICAgLy8gZXhwb3NlIGVudW0gdG8gdmlld1xuICAgIGVzdGltYXRlRGlyZWN0aW9ucyA9IEVzdGltYXRlRGlyZWN0aW9uO1xuICAgIGhpZ2hsaWdodFR5cGVzID0gSGlnaGxpZ2h0VHlwZTtcbiAgICB2aWV3TW9kZXMgPSBWaWV3TW9kZTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX3BsYW5TZXJ2aWNlOiBQbGFuU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBfc3ludGF4SGlnaGxpZ2h0U2VydmljZTogU3ludGF4SGlnaGxpZ2h0U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBfaGVscFNlcnZpY2U6IEhlbHBTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIF9jb2xvclNlcnZpY2U6IENvbG9yU2VydmljZSkgeyB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50SGlnaGxpZ2h0VHlwZSA9IHRoaXMudmlld09wdGlvbnMuaGlnaGxpZ2h0VHlwZTtcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVCYXIoKTtcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVQcm9wcygpO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZUR1cmF0aW9uKCk7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlVGFncygpO1xuXG4gICAgICAgIHRoaXMucGxhbm5lclJvd0VzdGltYXRlRGlyZWN0aW9uID0gdGhpcy5ub2RlW3RoaXMuX3BsYW5TZXJ2aWNlLlBMQU5ORVJfRVNJTUFURV9ESVJFQ1RJT05dO1xuICAgICAgICB0aGlzLnBsYW5uZXJSb3dFc3RpbWF0ZVZhbHVlID0gXy5yb3VuZCh0aGlzLm5vZGVbdGhpcy5fcGxhblNlcnZpY2UuUExBTk5FUl9FU1RJTUFURV9GQUNUT1JdKTtcbiAgICB9XG5cbiAgICBuZ0RvQ2hlY2soKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRIaWdobGlnaHRUeXBlICE9PSB0aGlzLnZpZXdPcHRpb25zLmhpZ2hsaWdodFR5cGUpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEhpZ2hsaWdodFR5cGUgPSB0aGlzLnZpZXdPcHRpb25zLmhpZ2hsaWdodFR5cGU7XG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZUJhcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbXBhY3RWaWV3ICE9PSB0aGlzLnZpZXdPcHRpb25zLnNob3dDb21wYWN0Vmlldykge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29tcGFjdFZpZXcgPSB0aGlzLnZpZXdPcHRpb25zLnNob3dDb21wYWN0VmlldztcbiAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlQmFyKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jdXJyZW50RXhwYW5kZWRWaWV3ICE9PSB0aGlzLnNob3dEZXRhaWxzKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRFeHBhbmRlZFZpZXcgPSB0aGlzLnNob3dEZXRhaWxzO1xuICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVCYXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldEZvcm1hdHRlZFF1ZXJ5KCkge1xuICAgICAgICB2YXIga2V5SXRlbXM6IEFycmF5PHN0cmluZz4gPSBbXTtcblxuICAgICAgICAvLyByZWxhdGlvbiBuYW1lIHdpbGwgYmUgaGlnaGxpZ2h0ZWQgZm9yIFNDQU4gbm9kZXNcbiAgICAgICAgdmFyIHJlbGF0aW9uTmFtZTogc3RyaW5nID0gdGhpcy5ub2RlW3RoaXMuX3BsYW5TZXJ2aWNlLlJFTEFUSU9OX05BTUVfUFJPUF07XG4gICAgICAgIGlmIChyZWxhdGlvbk5hbWUpIHtcbiAgICAgICAgICAgIGtleUl0ZW1zLnB1c2godGhpcy5ub2RlW3RoaXMuX3BsYW5TZXJ2aWNlLlNDSEVNQV9QUk9QXSArICcuJyArIHJlbGF0aW9uTmFtZSk7XG4gICAgICAgICAgICBrZXlJdGVtcy5wdXNoKCcgJyArIHJlbGF0aW9uTmFtZSk7XG4gICAgICAgICAgICBrZXlJdGVtcy5wdXNoKCcgJyArIHRoaXMubm9kZVt0aGlzLl9wbGFuU2VydmljZS5BTElBU19QUk9QXSArICcgJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBncm91cCBrZXkgd2lsbCBiZSBoaWdobGlnaHRlZCBmb3IgQUdHUkVHQVRFIG5vZGVzXG4gICAgICAgIHZhciBncm91cEtleTogQXJyYXk8c3RyaW5nPiA9IHRoaXMubm9kZVt0aGlzLl9wbGFuU2VydmljZS5HUk9VUF9LRVlfUFJPUF07XG4gICAgICAgIGlmIChncm91cEtleSkge1xuICAgICAgICAgICAga2V5SXRlbXMucHVzaCgnR1JPVVAgQlkgJyArIGdyb3VwS2V5LmpvaW4oJywnKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBoYXNoIGNvbmRpdGlvbiB3aWxsIGJlIGhpZ2hsaWdodGVkIGZvciBIQVNIIEpPSU4gbm9kZXNcbiAgICAgICAgdmFyIGhhc2hDb25kaXRpb246IHN0cmluZyA9IHRoaXMubm9kZVt0aGlzLl9wbGFuU2VydmljZS5IQVNIX0NPTkRJVElPTl9QUk9QXTtcbiAgICAgICAgaWYgKGhhc2hDb25kaXRpb24pIHtcbiAgICAgICAgICAgIGtleUl0ZW1zLnB1c2goaGFzaENvbmRpdGlvbi5yZXBsYWNlKCcoJywgJycpLnJlcGxhY2UoJyknLCAnJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMubm9kZVt0aGlzLl9wbGFuU2VydmljZS5OT0RFX1RZUEVfUFJPUF0udG9VcHBlckNhc2UoKSA9PT0gJ0xJTUlUJykge1xuICAgICAgICAgICAga2V5SXRlbXMucHVzaCgnTElNSVQnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fc3ludGF4SGlnaGxpZ2h0U2VydmljZS5oaWdobGlnaHQodGhpcy5wbGFuLnF1ZXJ5LCBrZXlJdGVtcyk7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlQmFyKCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMudmlld09wdGlvbnMudmlld01vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgVmlld01vZGUuRE9UOlxuICAgICAgICAgICAgICAgIHRoaXMuYmFyQ29udGFpbmVyV2lkdGggPSB0aGlzLkRPVF9XSURUSDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgVmlld01vZGUuQ09NUEFDVDpcbiAgICAgICAgICAgICAgICB0aGlzLmJhckNvbnRhaW5lcldpZHRoID0gdGhpcy5DT01QQUNUX1dJRFRIO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLmJhckNvbnRhaW5lcldpZHRoID0gdGhpcy5OT1JNQUxfV0lEVEg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBleHBhbmRlZCB2aWV3IHdpZHRoIHRydW1wcyBvdGhlcnNcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEV4cGFuZGVkVmlldykge1xuICAgICAgICAgICAgdGhpcy5iYXJDb250YWluZXJXaWR0aCA9IHRoaXMuRVhQQU5ERURfV0lEVEg7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKHRoaXMuY3VycmVudEhpZ2hsaWdodFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgSGlnaGxpZ2h0VHlwZS5EVVJBVElPTjpcbiAgICAgICAgICAgICAgICB0aGlzLmhpZ2hsaWdodFZhbHVlID0gKHRoaXMubm9kZVt0aGlzLl9wbGFuU2VydmljZS5BQ1RVQUxfRFVSQVRJT05fUFJPUF0pO1xuICAgICAgICAgICAgICAgIHRoaXMuYmFyV2lkdGggPSBNYXRoLnJvdW5kKCh0aGlzLmhpZ2hsaWdodFZhbHVlIC8gdGhpcy5wbGFuLnBsYW5TdGF0cy5tYXhEdXJhdGlvbikgKiB0aGlzLmJhckNvbnRhaW5lcldpZHRoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgSGlnaGxpZ2h0VHlwZS5ST1dTOlxuICAgICAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0VmFsdWUgPSAodGhpcy5ub2RlW3RoaXMuX3BsYW5TZXJ2aWNlLkFDVFVBTF9ST1dTX1BST1BdKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJhcldpZHRoID0gTWF0aC5yb3VuZCgodGhpcy5oaWdobGlnaHRWYWx1ZSAvIHRoaXMucGxhbi5wbGFuU3RhdHMubWF4Um93cykgKiB0aGlzLmJhckNvbnRhaW5lcldpZHRoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgSGlnaGxpZ2h0VHlwZS5DT1NUOlxuICAgICAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0VmFsdWUgPSAodGhpcy5ub2RlW3RoaXMuX3BsYW5TZXJ2aWNlLkFDVFVBTF9DT1NUX1BST1BdKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJhcldpZHRoID0gTWF0aC5yb3VuZCgodGhpcy5oaWdobGlnaHRWYWx1ZSAvIHRoaXMucGxhbi5wbGFuU3RhdHMubWF4Q29zdCkgKiB0aGlzLmJhckNvbnRhaW5lcldpZHRoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmJhcldpZHRoIDwgMSkge1xuICAgICAgICAgICAgdGhpcy5iYXJXaWR0aCA9IDE7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IHRoaXMuX2NvbG9yU2VydmljZS5udW1iZXJUb0NvbG9ySHNsKDEgLSB0aGlzLmJhcldpZHRoIC8gdGhpcy5iYXJDb250YWluZXJXaWR0aCk7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlRHVyYXRpb24oKSB7XG4gICAgICAgIHRoaXMuZXhlY3V0aW9uVGltZVBlcmNlbnQgPSAoXy5yb3VuZCgodGhpcy5ub2RlW3RoaXMuX3BsYW5TZXJ2aWNlLkFDVFVBTF9EVVJBVElPTl9QUk9QXSAvIHRoaXMucGxhbi5wbGFuU3RhdHMuZXhlY3V0aW9uVGltZSkgKiAxMDApKTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgYW4gYXJyYXkgb2Ygbm9kZSBwcm9wZXRpZXMgc28gdGhhdCB0aGV5IGNhbiBiZSBkaXNwbGF5ZWQgaW4gdGhlIHZpZXdcbiAgICBjYWxjdWxhdGVQcm9wcygpIHtcbiAgICAgICAgdGhpcy5wcm9wcyA9IF8uY2hhaW4odGhpcy5ub2RlKVxuICAgICAgICAgICAgLm9taXQodGhpcy5fcGxhblNlcnZpY2UuUExBTlNfUFJPUClcbiAgICAgICAgICAgIC5tYXAoKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBrZXk6IGtleSwgdmFsdWU6IHZhbHVlIH07XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnZhbHVlKCk7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlVGFncygpIHtcbiAgICAgICAgdGhpcy50YWdzID0gW107XG4gICAgICAgIGlmICh0aGlzLm5vZGVbdGhpcy5fcGxhblNlcnZpY2UuU0xPV0VTVF9OT0RFX1BST1BdKSB7XG4gICAgICAgICAgICB0aGlzLnRhZ3MucHVzaCh0aGlzLlNMT1dfVEFHKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ub2RlW3RoaXMuX3BsYW5TZXJ2aWNlLkNPU1RMSUVTVF9OT0RFX1BST1BdKSB7XG4gICAgICAgICAgICB0aGlzLnRhZ3MucHVzaCh0aGlzLkNPU1RMWV9UQUcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5vZGVbdGhpcy5fcGxhblNlcnZpY2UuTEFSR0VTVF9OT0RFX1BST1BdKSB7XG4gICAgICAgICAgICB0aGlzLnRhZ3MucHVzaCh0aGlzLkxBUkdFX1RBRyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubm9kZVt0aGlzLl9wbGFuU2VydmljZS5QTEFOTkVSX0VTVElNQVRFX0ZBQ1RPUl0gPj0gdGhpcy5NSU5fRVNUSU1BVEVfTUlTUykge1xuICAgICAgICAgICAgdGhpcy50YWdzLnB1c2godGhpcy5FU1RJTUFURV9UQUcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0Tm9kZVR5cGVEZXNjcmlwdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hlbHBTZXJ2aWNlLmdldE5vZGVUeXBlRGVzY3JpcHRpb24odGhpcy5ub2RlW3RoaXMuX3BsYW5TZXJ2aWNlLk5PREVfVFlQRV9QUk9QXSk7XG4gICAgfVxuXG4gICAgZ2V0Tm9kZU5hbWUoKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXdPcHRpb25zLnZpZXdNb2RlID09PSBWaWV3TW9kZS5ET1QgJiYgIXRoaXMuc2hvd0RldGFpbHMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vZGVbdGhpcy5fcGxhblNlcnZpY2UuTk9ERV9UWVBFX1BST1BdLnJlcGxhY2UoL1teQS1aXS9nLCAnJykudG9VcHBlckNhc2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAodGhpcy5ub2RlW3RoaXMuX3BsYW5TZXJ2aWNlLk5PREVfVFlQRV9QUk9QXSkudG9VcHBlckNhc2UoKTtcbiAgICB9XG5cbiAgICBnZXRUYWdOYW1lKHRhZ05hbWU6IFN0cmluZykge1xuICAgICAgICBpZiAodGhpcy52aWV3T3B0aW9ucy52aWV3TW9kZSA9PT0gVmlld01vZGUuRE9UICYmICF0aGlzLnNob3dEZXRhaWxzKSB7XG4gICAgICAgICAgICByZXR1cm4gdGFnTmFtZS5jaGFyQXQoMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRhZ05hbWU7XG4gICAgfVxuXG4gICAgc2hvdWxkU2hvd1BsYW5uZXJFc3RpbWF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMudmlld09wdGlvbnMuc2hvd1BsYW5uZXJFc3RpbWF0ZSAmJiB0aGlzLnNob3dEZXRhaWxzKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnZpZXdPcHRpb25zLnZpZXdNb2RlID09PSBWaWV3TW9kZS5ET1QpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdPcHRpb25zLnNob3dQbGFubmVyRXN0aW1hdGU7XG4gICAgfVxuXG4gICAgc2hvdWxkU2hvd05vZGVCYXJMYWJlbCgpIHtcbiAgICAgIGlmICh0aGlzLnNob3dEZXRhaWxzKSB7XG4gICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMudmlld09wdGlvbnMudmlld01vZGUgPT09IFZpZXdNb2RlLkRPVCkge1xuICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==